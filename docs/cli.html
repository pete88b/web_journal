---

title: CLI


keywords: fastai
sidebar: home_sidebar

summary: "Command line tools for working with storage."
description: "Command line tools for working with storage."
nb_path: "50_cli.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 50_cli.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="upload_dataset" class="doc_header"><code>upload_dataset</code><a href="https://github.com/pete88b/storage_tools/tree/main/storage_tools/cli.py#L10" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>upload_dataset</code>(<strong><code>storage_name</code></strong>:"Section name in config", <strong><code>dataset_name</code></strong>:"Dataset name", <strong><code>config_name</code></strong>:"Path to config"=<em><code>'secrets/settings.ini'</code></em>, <strong><code>dataset_version</code></strong>:"Dataset version"=<em><code>'patch'</code></em>)</p>
</blockquote>
<p>Create a new dataset archive and upload it to remote storage</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_dataset" class="doc_header"><code>download_dataset</code><a href="https://github.com/pete88b/storage_tools/tree/main/storage_tools/cli.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_dataset</code>(<strong><code>storage_name</code></strong>:"Section name in config", <strong><code>dataset_name</code></strong>:"Dataset name", <strong><code>config_name</code></strong>:"Path to config"=<em><code>'secrets/settings.ini'</code></em>, <strong><code>dataset_version</code></strong>:"Dataset version"=<em><code>'latest'</code></em>, <strong><code>overwrite</code></strong>:"If True, delete the dataset and re-download"=<em><code>False</code></em>)</p>
</blockquote>
<p>Download a dataset archive from remote storage</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we have a project folder containing</p>
<pre>
project_root
  &angrt; data
    &angrt; mnist
      &angrt; hand_drawn_digits
        &angrt; digit0.png
        &angrt; digit1.png
        &angrt; ...
  &angrt; secrets
    &angrt; settings.ini
&angrt; main.py
</pre><p>where <code>settings.ini</code> contains</p>

<pre><code>[DEFAULT]
local_path=data

[azure_demo]
storage_client=storage_tools.core.AzureStorageClient
conn_str=&lt;A connection string to an Azure Storage account without credential&gt;
credential=&lt;The credentials with which to authenticate&gt;
container=&lt;The name of a storage container&gt;</code></pre>
<p>We can</p>
<h3 id="Create-a-new-version-of-a-dataset">Create a new version of a dataset<a class="anchor-link" href="#Create-a-new-version-of-a-dataset"> </a></h3>
<pre><code>upload_dataset azure_demo mnist/hand_drawn_digits --dataset_version=major</code></pre>
<h3 id="Download-the-latest-version-of-a-dataset">Download the latest version of a dataset<a class="anchor-link" href="#Download-the-latest-version-of-a-dataset"> </a></h3><p>Feel free to delete your local copy of this dataset (from data) to download from azure storage.</p>

<pre><code>download_dataset azure_demo mnist/hand_drawn_digits</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">_make_local_test_data</span><span class="p">():</span>
    <span class="n">test_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a/b/test_data.txt&#39;</span><span class="p">,</span><span class="s1">&#39;a/b/more_test_data.txt&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_files</span><span class="p">):</span>
        <span class="n">f</span><span class="o">=</span><span class="s1">&#39;test/local_path/&#39;</span><span class="o">+</span><span class="n">f</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_file</span><span class="p">:</span> <span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a little bit of data </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_files</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;test/local_path&#39;</span><span class="p">,</span><span class="s1">&#39;test/storage_area&#39;</span><span class="p">]:</span> <span class="n">_rmtree</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">test_files</span><span class="o">=</span><span class="n">_make_local_test_data</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_t</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span><span class="n">upload_name</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;patch&#39;</span><span class="p">):</span>
    <span class="n">upload_dataset</span><span class="p">(</span><span class="s1">&#39;local_test&#39;</span><span class="p">,</span><span class="n">upload_name</span><span class="p">,</span><span class="s1">&#39;test/settings.ini&#39;</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>
<span class="n">_t</span><span class="p">(</span><span class="s1">&#39;a.3.0.0.zip&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;3.0.0&#39;</span><span class="p">)</span>
<span class="n">_t</span><span class="p">(</span><span class="s1">&#39;a.3.0.1.zip&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="c1"># TODO: check zip contents</span>
<span class="n">_rmtree</span><span class="p">(</span><span class="s1">&#39;test/local_path/a.3.0.0&#39;</span><span class="p">)</span>
<span class="n">_rmtree</span><span class="p">(</span><span class="s1">&#39;test/local_path/a.3.0.1&#39;</span><span class="p">)</span>

<span class="n">download_dataset</span><span class="p">(</span><span class="s1">&#39;local_test&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;test/settings.ini&#39;</span><span class="p">)</span>
<span class="n">download_dataset</span><span class="p">(</span><span class="s1">&#39;local_test&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;test/settings.ini&#39;</span><span class="p">,</span><span class="s1">&#39;3.0.0&#39;</span><span class="p">)</span>
<span class="n">download_dataset</span><span class="p">(</span><span class="s1">&#39;local_test&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;test/settings.ini&#39;</span><span class="p">,</span><span class="s1">&#39;3.0.0&#39;</span><span class="p">)</span>
<span class="n">download_dataset</span><span class="p">(</span><span class="s1">&#39;local_test&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;test/settings.ini&#39;</span><span class="p">,</span><span class="s1">&#39;3.0.0&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Dataset uploaded to test\storage_area\a.3.0.0.zip
Dataset uploaded to test\storage_area\a.3.0.1.zip
Dataset downloaded to test\local_path\a.3.0.1
Dataset downloaded to test\local_path\a.3.0.0
Dataset downloaded to test\local_path\a.3.0.0
Dataset downloaded to test\local_path\a.3.0.0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;test/local_path&#39;</span><span class="p">,</span><span class="s1">&#39;test/storage_area&#39;</span><span class="p">]:</span> <span class="n">_rmtree</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

